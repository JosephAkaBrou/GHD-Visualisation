annotate(geom = "text", x = -20, y = 31, label = "NA", color = "grey22", size = 4)
p <- girafe(ggobj = gg) %>%
girafe_options(opts_tooltip(opacity = .8),
opts_zoom(min = .5, max = 4),
opts_hover(css = "fill:white;stroke:orange;r:7pt;") )
View(df_geo_pop)
View(df_final)
typeof(df_finam)
typeof(df_final$col_geometry)
type(df_final)
typeof(df_final)
typeof(europe.clipped)
class(df_final)
colnames(df_final)
df_final$col_admin
shiny::runApp()
runApp()
library(shiny)
library(shinymaterial)
source("carto.R")
library(leaflet)
library(plotly)
library(ggplot2)
library(hrbrthemes)
library(dplyr)
library(ggforce)
#df = read.csv('./data3.csv')
data3 = read.csv("data3.csv", sep = ",")
#df = data3[data3$cause == input$id_cause & data3$year == input$id_an,]
df = data3[data3$cause == "Road injuries" & data3$year =="2017",]
df_select = df[,c("location", "sex", "val")]
df_t = dcast(df_select, location ~ sex, fun = sum)
df_t$total = df_t$Female + df_t$Male
df_t$taux_female = paste(round((df_t$Female / df_t$total)*100,0), "%")
df_t$taux_male = paste(round((df_t$Male / df_t$total)*100,0), "%")
df_t$Country = df_t$location
# Jointure
df_final = left_join(df_geo_pop,df_t, by = c("admin"="location"))
colnames(df_final) = paste0("col_",colnames(df_final))
#col_year =  paste0("`",as.numeric(input$id_an), "`")
#name_col = paste0("col_", input$id_an)
name_col = paste0("col_", "2017")
chosen_year=  df_final[[name_col]]
# Carte
gg <- ggplot(df_final) +
geom_sf_interactive(mapping = aes(fill = (col_total/chosen_year)*100,
tooltip = paste("Pays : ",
col_admin,"<br/>",
"Taux de mortalité : ",
paste(round((col_total/chosen_year)*100,2), " %"), "<br/>",
"Nombre de morts : ",
round(col_total,0), "<br/>",
"Taux de morts 'Female' : ",
col_taux_female, "<br/>",
"Taux de morts 'Male' : ",
col_taux_male, "<br/>"),
data_id = col_admin))+
scale_fill_gradient2(name = "Taux de mortalité (en %)",mid = "lightyellow", high = "red",
na.value="lightgrey",guide = "colourbar")+
#ggtitle(paste("Nombre de mortalité en ", str(input$id_an)))+
ggtitle(paste("Nombre de mortalité en "))+
theme(plot.title = element_text(hjust = 0.5, face = "bold"))+
theme(axis.text.x = element_blank(),
axis.ticks.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = element_rect(fill = "gray96"))+
xlab(NULL)+
ylab(NULL)+
geom_rect(xmin = -25, xmax = -15, ymin = 30, ymax = 32,
fill = "lightgrey", color = "gray43", size = 0.4)+
annotate(geom = "text", x = -20, y = 31, label = "NA", color = "grey22", size = 4)
p <- girafe(ggobj = gg) %>%
girafe_options(opts_tooltip(opacity = .8),
opts_zoom(min = .5, max = 4),
opts_hover(css = "fill:white;stroke:orange;r:7pt;") )
# Carte
gg <- ggplot(df_final) +
geom_sf_interactive(mapping = aes(fill = (df_final$col_total/chosen_year)*100,
tooltip = paste("Pays : ",
col_admin,"<br/>",
"Taux de mortalité : ",
paste(round((df_final$col_total/chosen_year)*100,2), " %"), "<br/>",
"Nombre de morts : ",
round(df_final$col_total,0), "<br/>",
"Taux de morts 'Female' : ",
df_final$col_taux_female, "<br/>",
"Taux de morts 'Male' : ",
df_final$col_taux_male, "<br/>"),
data_id = df_final$col_admin))+
scale_fill_gradient2(name = "Taux de mortalité (en %)",mid = "lightyellow", high = "red",
na.value="lightgrey",guide = "colourbar")+
#ggtitle(paste("Nombre de mortalité en ", str(input$id_an)))+
ggtitle(paste("Nombre de mortalité en "))+
theme(plot.title = element_text(hjust = 0.5, face = "bold"))+
theme(axis.text.x = element_blank(),
axis.ticks.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = element_rect(fill = "gray96"))+
xlab(NULL)+
ylab(NULL)+
geom_rect(xmin = -25, xmax = -15, ymin = 30, ymax = 32,
fill = "lightgrey", color = "gray43", size = 0.4)+
annotate(geom = "text", x = -20, y = 31, label = "NA", color = "grey22", size = 4)
p <- girafe(ggobj = gg) %>%
girafe_options(opts_tooltip(opacity = .8),
opts_zoom(min = .5, max = 4),
opts_hover(css = "fill:white;stroke:orange;r:7pt;") )
colnames(df_final)
# Carte
gg <- ggplot(df_final) +
geom_sf_interactive(mapping = aes(fill = (df_final$col_total/df_final$col_2017)*100,
tooltip = paste("Pays : ",
col_admin,"<br/>",
"Taux de mortalité : ",
paste(round((df_final$col_total/df_final$col_2017)*100,2), " %"), "<br/>",
"Nombre de morts : ",
round(df_final$col_total,0), "<br/>",
"Taux de morts 'Female' : ",
df_final$col_taux_female, "<br/>",
"Taux de morts 'Male' : ",
df_final$col_taux_male, "<br/>"),
data_id = df_final$col_admin))+
scale_fill_gradient2(name = "Taux de mortalité (en %)",mid = "lightyellow", high = "red",
na.value="lightgrey",guide = "colourbar")+
#ggtitle(paste("Nombre de mortalité en ", str(input$id_an)))+
ggtitle(paste("Nombre de mortalité en "))+
theme(plot.title = element_text(hjust = 0.5, face = "bold"))+
theme(axis.text.x = element_blank(),
axis.ticks.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = element_rect(fill = "gray96"))+
xlab(NULL)+
ylab(NULL)+
geom_rect(xmin = -25, xmax = -15, ymin = 30, ymax = 32,
fill = "lightgrey", color = "gray43", size = 0.4)+
annotate(geom = "text", x = -20, y = 31, label = "NA", color = "grey22", size = 4)
p <- girafe(ggobj = gg) %>%
girafe_options(opts_tooltip(opacity = .8),
opts_zoom(min = .5, max = 4),
opts_hover(css = "fill:white;stroke:orange;r:7pt;") )
library(shiny)
library(shinymaterial)
source("carto.R")
library(leaflet)
library(plotly)
library(ggplot2)
library(hrbrthemes)
library(dplyr)
library(ggforce)
#df = read.csv('./data3.csv')
data3 = read.csv("data3.csv", sep = ",")
#df = data3[data3$cause == input$id_cause & data3$year == input$id_an,]
df = data3[data3$cause == "Road injuries" & data3$year =="2017",]
df_select = df[,c("location", "sex", "val")]
df_t = dcast(df_select, location ~ sex, fun = sum)
df_t$total = df_t$Female + df_t$Male
df_t$taux_female = paste(round((df_t$Female / df_t$total)*100,0), "%")
df_t$taux_male = paste(round((df_t$Male / df_t$total)*100,0), "%")
df_t$Country = df_t$location
# Jointure
df_final = left_join(df_geo_pop,df_t, by = c("admin"="location"))
# Carte
gg <- ggplot(df_final) +
geom_sf_interactive(mapping = aes(fill = (col_total/df_final$col_2017)*100,
tooltip = paste("Pays : ",
col_admin,"<br/>",
"Taux de mortalité : ",
paste(round((col_total/df_final$col_2017)*100,2), " %"), "<br/>",
"Nombre de morts : ",
round(col_total,0), "<br/>",
"Taux de morts 'Female' : ",
col_taux_female, "<br/>",
"Taux de morts 'Male' : ",
col_taux_male, "<br/>"),
data_id = col_admin))+
scale_fill_gradient2(name = "Taux de mortalité (en %)",mid = "lightyellow", high = "red",
na.value="lightgrey",guide = "colourbar")+
#ggtitle(paste("Nombre de mortalité en ", str(input$id_an)))+
ggtitle(paste("Nombre de mortalité en "))+
theme(plot.title = element_text(hjust = 0.5, face = "bold"))+
theme(axis.text.x = element_blank(),
axis.ticks.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = element_rect(fill = "gray96"))+
xlab(NULL)+
ylab(NULL)+
geom_rect(xmin = -25, xmax = -15, ymin = 30, ymax = 32,
fill = "lightgrey", color = "gray43", size = 0.4)+
annotate(geom = "text", x = -20, y = 31, label = "NA", color = "grey22", size = 4)
p <- girafe(ggobj = gg) %>%
girafe_options(opts_tooltip(opacity = .8),
opts_zoom(min = .5, max = 4),
opts_hover(css = "fill:white;stroke:orange;r:7pt;") )
# Carte
gg <- ggplot(df_final) +
geom_sf_interactive(mapping = aes(fill = (total/df_final$col_2017)*100,
tooltip = paste("Pays : ",
admin,"<br/>",
"Taux de mortalité : ",
paste(round((total/df_final$col_2017)*100,2), " %"), "<br/>",
"Nombre de morts : ",
round(total,0), "<br/>",
"Taux de morts 'Female' : ",
taux_female, "<br/>",
"Taux de morts 'Male' : ",
taux_male, "<br/>"),
data_id =dmin))+
scale_fill_gradient2(name = "Taux de mortalité (en %)",mid = "lightyellow", high = "red",
na.value="lightgrey",guide = "colourbar")+
#ggtitle(paste("Nombre de mortalité en ", str(input$id_an)))+
ggtitle(paste("Nombre de mortalité en "))+
theme(plot.title = element_text(hjust = 0.5, face = "bold"))+
theme(axis.text.x = element_blank(),
axis.ticks.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = element_rect(fill = "gray96"))+
xlab(NULL)+
ylab(NULL)+
geom_rect(xmin = -25, xmax = -15, ymin = 30, ymax = 32,
fill = "lightgrey", color = "gray43", size = 0.4)+
annotate(geom = "text", x = -20, y = 31, label = "NA", color = "grey22", size = 4)
p <- girafe(ggobj = gg) %>%
girafe_options(opts_tooltip(opacity = .8),
opts_zoom(min = .5, max = 4),
opts_hover(css = "fill:white;stroke:orange;r:7pt;") )
# Carte
gg <- ggplot(df_final) +
geom_sf_interactive(mapping = aes(fill = (total/df_final$col_2017)*100,
tooltip = paste("Pays : ",
admin,"<br/>",
"Taux de mortalité : ",
paste(round((total/df_final$col_2017)*100,2), " %"), "<br/>",
"Nombre de morts : ",
round(total,0), "<br/>",
"Taux de morts 'Female' : ",
taux_female, "<br/>",
"Taux de morts 'Male' : ",
taux_male, "<br/>"),
data_id =admin))+
scale_fill_gradient2(name = "Taux de mortalité (en %)",mid = "lightyellow", high = "red",
na.value="lightgrey",guide = "colourbar")+
#ggtitle(paste("Nombre de mortalité en ", str(input$id_an)))+
ggtitle(paste("Nombre de mortalité en "))+
theme(plot.title = element_text(hjust = 0.5, face = "bold"))+
theme(axis.text.x = element_blank(),
axis.ticks.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = element_rect(fill = "gray96"))+
xlab(NULL)+
ylab(NULL)+
geom_rect(xmin = -25, xmax = -15, ymin = 30, ymax = 32,
fill = "lightgrey", color = "gray43", size = 0.4)+
annotate(geom = "text", x = -20, y = 31, label = "NA", color = "grey22", size = 4)
p <- girafe(ggobj = gg) %>%
girafe_options(opts_tooltip(opacity = .8),
opts_zoom(min = .5, max = 4),
opts_hover(css = "fill:white;stroke:orange;r:7pt;") )
p <- girafe(ggobj = gg) %>%
girafe_options(opts_tooltip(opacity = .8),
opts_zoom(min = .5, max = 4),
opts_hover(css = "fill:white;stroke:orange;r:7pt;") )
# Carte
gg <- ggplot(df_final) +
geom_sf_interactive(mapping = aes(fill = (total/df_final$`2017`)*100,
tooltip = paste("Pays : ",
admin,"<br/>",
"Taux de mortalité : ",
paste(round((total/`2017`)*100,2), " %"), "<br/>",
"Nombre de morts : ",
round(total,0), "<br/>",
"Taux de morts 'Female' : ",
taux_female, "<br/>",
"Taux de morts 'Male' : ",
taux_male, "<br/>"),
data_id =admin))+
scale_fill_gradient2(name = "Taux de mortalité (en %)",mid = "lightyellow", high = "red",
na.value="lightgrey",guide = "colourbar")+
#ggtitle(paste("Nombre de mortalité en ", str(input$id_an)))+
ggtitle(paste("Nombre de mortalité en "))+
theme(plot.title = element_text(hjust = 0.5, face = "bold"))+
theme(axis.text.x = element_blank(),
axis.ticks.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = element_rect(fill = "gray96"))+
xlab(NULL)+
ylab(NULL)+
geom_rect(xmin = -25, xmax = -15, ymin = 30, ymax = 32,
fill = "lightgrey", color = "gray43", size = 0.4)+
annotate(geom = "text", x = -20, y = 31, label = "NA", color = "grey22", size = 4)
p <- girafe(ggobj = gg) %>%
girafe_options(opts_tooltip(opacity = .8),
opts_zoom(min = .5, max = 4),
opts_hover(css = "fill:white;stroke:orange;r:7pt;") )
# Carte
gg <- ggplot(df_final) +
geom_sf_interactive(mapping = aes(fill = (total/`2017`)*100,
tooltip = paste("Pays : ",
admin,"<br/>",
"Taux de mortalité : ",
paste(round((total/`2017`)*100,2), " %"), "<br/>",
"Nombre de morts : ",
round(total,0), "<br/>",
"Taux de morts 'Female' : ",
taux_female, "<br/>",
"Taux de morts 'Male' : ",
taux_male, "<br/>"),
data_id =admin))+
scale_fill_gradient2(name = "Taux de mortalité (en %)",mid = "lightyellow", high = "red",
na.value="lightgrey",guide = "colourbar")+
#ggtitle(paste("Nombre de mortalité en ", str(input$id_an)))+
ggtitle(paste("Nombre de mortalité en "))+
theme(plot.title = element_text(hjust = 0.5, face = "bold"))+
theme(axis.text.x = element_blank(),
axis.ticks.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = element_rect(fill = "gray96"))+
xlab(NULL)+
ylab(NULL)+
geom_rect(xmin = -25, xmax = -15, ymin = 30, ymax = 32,
fill = "lightgrey", color = "gray43", size = 0.4)+
annotate(geom = "text", x = -20, y = 31, label = "NA", color = "grey22", size = 4)
p <- girafe(ggobj = gg) %>%
girafe_options(opts_tooltip(opacity = .8),
opts_zoom(min = .5, max = 4),
opts_hover(css = "fill:white;stroke:orange;r:7pt;") )
if( interactive() ) print(p)
eval(parse("Res"))
?assign
# Carte
gg <- ggplot(df_final) +
geom_sf_interactive(mapping = aes(fill = (total/eval(parse(text = "2017")))*100,
tooltip = paste("Pays : ",
admin,"<br/>",
"Taux de mortalité : ",
paste(round((total/eval(parse(text = "2017")))*100,2), " %"), "<br/>",
"Nombre de morts : ",
round(total,0), "<br/>",
"Taux de morts 'Female' : ",
taux_female, "<br/>",
"Taux de morts 'Male' : ",
taux_male, "<br/>"),
data_id =admin))+
scale_fill_gradient2(name = "Taux de mortalité (en %)",mid = "lightyellow", high = "red",
na.value="lightgrey",guide = "colourbar")+
#ggtitle(paste("Nombre de mortalité en ", str(input$id_an)))+
ggtitle(paste("Nombre de mortalité en "))+
theme(plot.title = element_text(hjust = 0.5, face = "bold"))+
theme(axis.text.x = element_blank(),
axis.ticks.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = element_rect(fill = "gray96"))+
xlab(NULL)+
ylab(NULL)+
geom_rect(xmin = -25, xmax = -15, ymin = 30, ymax = 32,
fill = "lightgrey", color = "gray43", size = 0.4)+
annotate(geom = "text", x = -20, y = 31, label = "NA", color = "grey22", size = 4)
p <- girafe(ggobj = gg) %>%
girafe_options(opts_tooltip(opacity = .8),
opts_zoom(min = .5, max = 4),
opts_hover(css = "fill:white;stroke:orange;r:7pt;") )
if( interactive() ) print(p)
runApp()
df = data3[data3$cause == "Road injuries" & data3$year =="2017",]
df_select = df[,c("location", "sex", "val")]
df_t = dcast(df_select, location ~ sex, fun = sum)
df_t$total = df_t$Female + df_t$Male
df_t$taux_female = paste(round((df_t$Female / df_t$total)*100,0), "%")
df_t$taux_male = paste(round((df_t$Male / df_t$total)*100,0), "%")
df_t$Country = df_t$location
# Jointure
df_final = left_join(df_geo_pop,df_t, by = c("admin"="location"))
# Carte
gg <- ggplot(df_final) +
geom_sf_interactive(mapping = aes(fill = (total/(eval(parse(text = "2017"))))*100,
tooltip = paste("Pays : ",
admin,"<br/>",
"Taux de mortalité : ",
paste(round((total/(eval(parse(text = "2017"))))*100,2), " %"), "<br/>",
"Nombre de morts : ",
round(total,0), "<br/>",
"Taux de morts 'Female' : ",
taux_female, "<br/>",
"Taux de morts 'Male' : ",
taux_male, "<br/>"),
data_id =admin))+
scale_fill_gradient2(name = "Taux de mortalité (en %)",mid = "lightyellow", high = "red",
na.value="lightgrey",guide = "colourbar")+
ggtitle(paste("Taux de mortalité en ", input$id_an, "par", input$id_cause))+
theme(plot.title = element_text(hjust = 0.5, face = "bold"))+
theme(axis.text.x = element_blank(),
axis.ticks.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = element_rect(fill = "gray96"))+
xlab(NULL)+
ylab(NULL)+
geom_rect(xmin = -25, xmax = -15, ymin = 30, ymax = 32,
fill = "lightgrey", color = "gray43", size = 0.4)+
annotate(geom = "text", x = -20, y = 31, label = "NA", color = "grey22", size = 4)
girafe(ggobj = gg) %>%
girafe_options(opts_tooltip(opacity = .8),
opts_zoom(min = .5, max = 4),
opts_hover(css = "fill:white;stroke:orange;r:7pt;") )
df = data3[data3$cause == "Road injuries" & data3$year =="2017",]
#df = read.csv('./data3.csv')
data3 = read.csv("data3.csv", sep = ",")
df = data3[data3$cause == "Road injuries" & data3$year =="2017",]
df_select = df[,c("location", "sex", "val")]
df_t = dcast(df_select, location ~ sex, fun = sum)
df_t$total = df_t$Female + df_t$Male
df_t$taux_female = paste(round((df_t$Female / df_t$total)*100,0), "%")
df_t$taux_male = paste(round((df_t$Male / df_t$total)*100,0), "%")
df_t$Country = df_t$location
# Jointure
df_final = left_join(df_geo_pop,df_t, by = c("admin"="location"))
# Carte
gg <- ggplot(df_final) +
geom_sf_interactive(mapping = aes(fill = (total/(eval(parse(text = "2017"))))*100,
tooltip = paste("Pays : ",
admin,"<br/>",
"Taux de mortalité : ",
paste(round((total/(eval(parse(text = "2017"))))*100,2), " %"), "<br/>",
"Nombre de morts : ",
round(total,0), "<br/>",
"Taux de morts 'Female' : ",
taux_female, "<br/>",
"Taux de morts 'Male' : ",
taux_male, "<br/>"),
data_id =admin))+
scale_fill_gradient2(name = "Taux de mortalité (en %)",mid = "lightyellow", high = "red",
na.value="lightgrey",guide = "colourbar")+
ggtitle(paste("Taux de mortalité en ", input$id_an, "par", input$id_cause))+
theme(plot.title = element_text(hjust = 0.5, face = "bold"))+
theme(axis.text.x = element_blank(),
axis.ticks.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = element_rect(fill = "gray96"))+
xlab(NULL)+
ylab(NULL)+
geom_rect(xmin = -25, xmax = -15, ymin = 30, ymax = 32,
fill = "lightgrey", color = "gray43", size = 0.4)+
annotate(geom = "text", x = -20, y = 31, label = "NA", color = "grey22", size = 4)
# Carte
gg <- ggplot(df_final) +
geom_sf_interactive(mapping = aes(fill = (total/(eval(parse(text = "2017"))))*100,
tooltip = paste("Pays : ",
admin,"<br/>",
"Taux de mortalité : ",
paste(round((total/(eval(parse(text = "2017"))))*100,2), " %"), "<br/>",
"Nombre de morts : ",
round(total,0), "<br/>",
"Taux de morts 'Female' : ",
taux_female, "<br/>",
"Taux de morts 'Male' : ",
taux_male, "<br/>"),
data_id =admin))+
scale_fill_gradient2(name = "Taux de mortalité (en %)",mid = "lightyellow", high = "red",
na.value="lightgrey",guide = "colourbar")+
#ggtitle(paste("Taux de mortalité en ", input$id_an, "par", input$id_cause))+
theme(plot.title = element_text(hjust = 0.5, face = "bold"))+
theme(axis.text.x = element_blank(),
axis.ticks.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = element_rect(fill = "gray96"))+
xlab(NULL)+
ylab(NULL)+
geom_rect(xmin = -25, xmax = -15, ymin = 30, ymax = 32,
fill = "lightgrey", color = "gray43", size = 0.4)+
annotate(geom = "text", x = -20, y = 31, label = "NA", color = "grey22", size = 4)
girafe(ggobj = gg) %>%
girafe_options(opts_tooltip(opacity = .8),
opts_zoom(min = .5, max = 4),
opts_hover(css = "fill:white;stroke:orange;r:7pt;") )
colnames(df_final) = paste0("col_",colnames(df_final))
runApp()
shiny::runApp()
runApp()
